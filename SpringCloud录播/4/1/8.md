发生服务降级后，向管理员发出警报通知  

对于相同的服务，多次触发服务降级不应该全部报警，特别是高并发环境下  
报警标识：给发生服务降级并发出通知的节点添加一个报警标识，避免再次触发相同服务降级时的多余报警  
报警标识的有效时间：自动取消报警标识，取消后再次触发降级时会进行报警通知，避免问题被遗忘  
报警操作应该是异步的：报警通知是一个 IO 过程，这个操作和服务降级的逻辑如果同步执行，会影响服务降级的响应时间  

---

如果将报警标识的有效时间存在 数据库里，并缓存到 Redis 里，在高并发情况下 Redis 需要注意以下问题  
- 缓存穿透问题：将有效时间存在数据库里，查询时先经过 Redis，查不到数据则从数据库中取出来放到 Redis 里，避免下一次查询时对数据库的请求。但如果数据库中没有查到数据，就不会存放到 Redis，每次查询都是先经过Redis再请求数据库。解决方案是，查不到数据时在 Redis 中自定义一个代表空的值    
- 缓存雪崩问题：同一时间需要对 Redis 缓存的很多条有效时间数据进行访问，恰巧遇到这些数据都到期了，于是大量请求涌向数据库。解决方案是尽量避免同一时间的大量数据失效，没有什么别的好解决方案  
- 热点缓存问题：同一时间需要对某一条缓存进行访问，访问量很大，又正好碰到这条数据过期，于是大量请求涌向数据库。解决方案是使用双重检查锁，还要注意双重检查锁的线程安全问题  

[back](../1.md)  
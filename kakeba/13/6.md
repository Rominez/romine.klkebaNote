CAS(Compare-And-Swap) 比较和交换  
是 atomic 类实现原子性的原理  

线程本地内存对主内存中的共享变量进行更新时
- 先比较原有的值和主内存是否相等  
- 如果相等，将主内存中的值替换成更改后的值
- 如果不相等，则重新进行尝试，一致到成功为止  

atomic 源码中依赖 UnSafe 类中的 CAS 方法，这些方法是 JVM 实现的 CAS 汇编指令，可以视为一条 CPU 的原子指令，是一种完全依赖于硬件的功能  

CAS 的缺点  
- 如果 CAS 长时间不成功，会给 CPU 带来很大的开销  
- 无法保证对多个共享变量操作的原子性。多个共享变量的情况需要用锁  
- ABA 问题 [see](6/1.md)  

[back](../13.md)  
# insert 语句的执行过程中做了哪些事  

Server层：  
- 建立连接  
- 解析语句  
- 优化执行计划  
- 交给存储引擎执行  

innodb  
- 开启事务  
- 加插入意向锁  
- 回滚日志写入redolog  
- 记录回滚日志  
- 变更记录写入redolog  
- 更新内存页，触发 checkpoint 时写入磁盘    
- redolog 落盘  
- 释放锁  

# innodb 的 RC 和 RR 隔离是怎么实现的  

通过维护数据版本链实现，数据发生修改时将这个版本的数据和事务ID一起缓存起来。然后使用 ReadView 控制事务可见的数据版本  
ReadView 将活跃的读写事务ID 放在一个列表中。如果一个数据版本对应的事务ID的小于列表里的最小值，或者等于当前事务的ID，说明生成这个版本数据的事务早已提交，可以被访问；如果这个版本的数据ID在ReadView内，说明修改这个版本的事务还是活跃的，不可以被访问；如果大于 ReadView 里的最大值，说明这个版本的数据在生成 ReadView 后才生成，不可以被当前事务访问    
RC 隔离级别每次查询开始时，生成一个独立的 ReadView  
RR 隔离级别在事务开启后第一次读取数据时生成一个 ReadView  
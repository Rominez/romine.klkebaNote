由一个或多个哨兵（Sentinel）服务器组成的哨兵系统可以监视任意多个主服务器以及其属下所有从服务器  
某个主服务器下线时，自动将其属下的某个从服务器升级为新的主服务器  

每个哨兵节点每10表会向主从节点发送 info 命令获取最新拓扑结构图  
哨兵配置时只需要配置对主节点的监控，新节点加入主节点时可以马上感知到  
每个哨兵节点每隔2秒发送该哨兵节点对于主节点的判断以及当前哨兵节点的信息  
哨兵节点订阅其他哨兵节点的信息来了解其他哨兵节点（发布订阅模式）  
每个哨兵节点每1秒会向主从节点、其他哨兵节点发送一次 ping 命令做心跳检测  

主观下线 status:sdown：单个sentinel认为某个服务器下线  
相关配置 [see](13/1.md)  
客观下线 status:odown：如果某个哨兵判定某个服务器下线  
会发送指令 `seninel is-masterdown-by-addr` 寻求其他哨兵对这个节点的判断  
检查有多少个哨兵服务器判断该服务器下线  
如果超过 quorum（选举）个数，即大多数哨兵节点同意下线操作，该服务器客观下线  

当某个主节点判定客观下线，需要选取一个哨兵节点来完成后续故障转移工作  
哨兵节点判定服务器客观下线，则发送 `is-jmaster-down-by-addr` 命令征求其他哨兵将子集设置为 leader  
其他哨兵收到此命令时，可以同意或拒绝，判断依据是  
- sentinel 配置纪元小于等于发送投票请求的节点的配置纪元（配置纪元就是第几轮发起投票）  
- 当前配置纪元中这是收到的第一个投票请求  
大于半数节点同意时该节点成为 leader 负责后续处理，否则继续选举  

自动故障转移机制 [see](13/2.md)  

如果意外地由多个哨兵选取了多个新的主节点，就会出现**脑裂**  
脑裂只能手动修复数据  

哨兵的启动和配置 [see](13/3.md)  

[back](../11.md)  
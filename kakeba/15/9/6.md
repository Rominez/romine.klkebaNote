流控即限流，Sentinel 通过监控应用流量的 QPS 或并发线程数等指标，达到指定的阈值时对请求进行控制  
避免服务被瞬时的流量高峰冲垮，从而保障服务的高可用性  

Hystrix 的实现方案是线程池隔离，而 Sentinel 没有采用线程池隔离也没有采用信号量隔离，而是对两者进行了优化    
- 线程池隔离：为不同的提供者资源创建不同的线程池，缺点是需要创建的池和线程数量太多  
- 信号量隔离：为不同的提供者资源设置不同的计数器，执行和请求是同一条线程，缺点是调用无法异步，执行效率低  
Sentinel 执行和请求线程是分离的，但不负责创建和管理线程池，而是统计对某资源请求占用的线程数量，超过阈值时拒绝新请求  
避免了创建线程池的开销，同时也融入了信号量隔离的特点  

流控参数  
- resource 资源名  
- count 限流阈值  
- grade 限流阈值类型，QPS 或 并发线程数
- limitApp 流控针对的调用来源  
若为 default 则不区分来源  
- strategy 调用关系限流模式  
    - 直接：对”资源名“指定的资源请求到达阈值时，新请求进行流控  
    - 关联：将几个资源关联在一起，对其中一个资源操作过于频繁时，影响关联资源的操作。比如读写操作可以关联起来  
    - 链路：对某一路径的访问进行限流，可用于服务提供者的 Service 层  
- controlBehavior 流量控制效果  
    - 快速失败：直接拒绝
    - Warm Up：QPS 缓步增加到设定的阈值
    当某资源的 QPS 长期处于低水平，系统设置的资源应该相对较少，但这样又无法面对陡然增加的访问量，因为创建线程分配缓存也需要消耗大量资源。因此需要冷启动，在一定时间范围内慢慢的达到设定阈值
    - 匀速排队：超出阈值的请求进行排队    
    类似漏桶算法，缓存多出来的请求，不支持超过 1000 QPS，因为需要的缓存太大

---

在代码中添加流控处理方法 [see](6/1.md)  
使用代码配置流控策略 [see](6/2.md)  

[back](../9.md)  
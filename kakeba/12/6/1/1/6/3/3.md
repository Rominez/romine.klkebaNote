记录锁：只对一条记录进行锁定  
InnoDB 做删改操作时都会加**记录排他锁**，保证了事务结束前相关数据不会被其他事务修改或删除  
如果是根据辅助索引更新数据，会在辅助索引上加间隙锁，然后在对应主索引上加记录锁  

间隙锁：锁住一个索引区间（开区间，不包括双端端点）  
可用于防止幻读，保证锁定的索引之间不会被插入数据    
根据主键等值查询，没有查询到数据时会加间隙锁，其它事务不能插入这个主键的值，保证了当前事务再次做相同的等值查询时同样不会查到数据。  
例如表中有 1 和 10 两个 id，当前事务查询 id=2，没有查到数据，这时 1~10 之间就会加上间隙锁，其他事务不能插入这个范围内的id  

- 临键锁：相当于记录锁+间隙锁  
当根据主键范围查询，命中多条记录时，会加临键锁，临键锁可以是闭区间  
innodb 加锁时默认使用临键锁，根据不同创建会退化成记录所或者间隙锁  
只有 RR 级别的事务隔离才会有临键锁  

- 插入意向锁：插入数据时的锁  


```
$ select ... lock in shard mode;
# 查询时加读锁  

$ select ... for update;
# 查询时加写锁  
```

[back](../3.md)  
Server 层  
- 建立连接  
- 解析语句  
- 优化执行计划，判断需要使用的索引  
- 执行  

InnoDB 引擎  
- 开启事务  
- 根据更新条件对数据进行加锁  
    - 如果条件是主键等值，加行锁    
    - 如果是主键范围更新，则主索引加间隙锁，再加行锁  
    - 如果应用辅助索引，则辅助索引加间隙锁和行锁，对应的主索引再加行锁  
    - 其他情况全表加行写锁、间隙锁  
- undolog 的 redolog 缓冲  
- 记录 undolog  
- 记录变更的 redolog 缓冲  
- 更新内存页  
- 事务提交，redolog落盘  
- 释放锁  


[back](../7.md)  